@using ECommerceApp.Application.Supporting.TimeManagement.Models
@model IReadOnlyList<JobExecutionRecord>
@{ ViewData["Title"] = $"History — {ViewBag.JobName}"; }

<div class="container mt-4">
    <h2>Execution History — <strong>@ViewBag.JobName</strong></h2>
    <a asp-action="Index" class="btn btn-secondary mb-3">Back to Jobs</a>
    <table class="table table-bordered table-sm">
        <thead class="thead-light">
            <tr><th>Started At</th><th>Duration</th><th>Trigger</th><th>Result</th><th>Message</th></tr>
        </thead>
        <tbody>
            @foreach (var r in Model)
            {
                <tr>
                    <td>@r.StartedAt.ToString("g")</td>
                    <td>@((r.CompletedAt - r.StartedAt).ToString(@"hh\:mm\:ss"))</td>
                    <td><span class="badge badge-secondary">@r.Source</span></td>
                    <td>
                        @if (r.Succeeded)
                        {
                            <span class="badge badge-success">OK</span>
                        }
                        else
                        {
                            <span class="badge badge-danger">Failed</span>
                        }
                    </td>
                    <td><small>@r.Message</small></td>
                </tr>
            }
        </tbody>
    </table>
    @if (Model.Count == (int)ViewBag.PageSize)
    {
        <a asp-action="History" asp-route-jobName="@ViewBag.JobName" asp-route-page="@((int)ViewBag.Page + 1)" asp-route-pageSize="@ViewBag.PageSize" class="btn btn-outline-secondary">Next page</a>
    }
    @if ((int)ViewBag.Page > 1)
    {
        <a asp-action="History" asp-route-jobName="@ViewBag.JobName" asp-route-page="@((int)ViewBag.Page - 1)" asp-route-pageSize="@ViewBag.PageSize" class="btn btn-outline-secondary">Prev page</a>
    }
</div>
